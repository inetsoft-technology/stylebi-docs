= Configure the Scheduler
%experimental%
include::ROOT:partial$buttonSnippets.adoc[]


To configure the Scheduler, follow the steps below:

. Press the {buttonSettings} at the top of Enterprise Manager.

. Select the *Schedule* page in the left panel, and select the *Settings* tab at the top.
+
image:Figure 32.png[]

The following sections explain the settings available for scheduled tasks.


== Scheduler Properties

Maximum Concurrent Threads::	Set the maximum number of threads that can be executed concurrently.

RMI Port Number::	The Scheduler server is an RMI application. By default RMI uses port 1099. If the default RMI port is not used, it can be changed here.

Scheduler Log File::	Contains log messages generated by the Scheduler.

Scheduler Classpath::	The classpath that will be prepended to the system classpath when the Scheduler process is started. The scheduler is a separate process with a separate JVM. Be sure to specify all the appropriate JAR files. The RMI registry will be started automatically. To modify the classpath, see xref:#EditSchedulerClasspath[] below.

Schedule Options::	Select options available to a user when they schedule tasks, such as ‘Notification Email’, etc. The ‘Enable Email Browser’ option allows the user to choose emails from a list for email actions.



Share Tasks Between Users in Same Group::	Allows users in the same group to access a scheduled task.  Enable the subordinate '`Modify By Owner Only`' option to prevent users other than the task creator from deleting or editing a task.

Save File Suffix::	Suffix to be automatically appended to the name of all files saved to the server by the Scheduler. User placeholder `pass:[{0}]` to insert the  Dashboard name, and use placeholder `pass:[{1}]` to insert the file creation date. You can specify a format for the *date* parameter using date format symbols.
+
.See a list  of available date format symbols...
[%collapsible]
====
For examples of how  to construct dates using these symbols, see xref:viewsheet:DataFormat.adoc#DateFormat[Date Format] in xref:viewsheet:VisualizeYourData.adoc[].


include::commonscript:partial$dateFormatTable.adoc[]
====
+
Some examples of automatically generated filenames (for a specified filename of “FileName”) are shown below.
+
|===
|Save File Suffix|Generated Filename

|`_{1,date}`|FileName_Nov 14, 2007.pdf
|`pass:[_{0}_{1,date}]`|FileName_DashboardName_Nov 14, 2007.pdf
|`_{1,date,MMM-dd}`|FileName_Nov-14.pdf
|`_{1,date,EEE-h-mm a}`|FileName_Wed-11-49 AM.pdf
|`_{1,date,yy-MM-dd-HH-z}`|FileName_07-11-14-11-EST.pdf
|===
Memory Usage::	Sets the minimum and maximum memory usage for the Scheduler.


[#EditSchedulerClasspath]
== Edit the Scheduler Classpath
To edit the Scheduler classpath, follow the steps below:

. Press the btn:[Edit] button below the classpath string.
+
image:Scheduler Classpath 1.png[]
+
This opens the ‘Schedule Classpath ‘ dialog box.
+
image:Scheduler Classpath 2.png[]

. To add a new entry to the classpath, press the btn:[New] button . Then type the desired path, and press btn:[OK].

. To edit an existing entry on the classpath, select the desired entry and press the btn:[Edit] button . Then edit the path as desired, and press btn:[OK].  To search through the path list, enter a full or partial search term in the ‘Filter’ box above the table.

. To delete an existing entry from the classpath, select the desired entry and press the btn:[Delete] button . Press btn:[OK].

. To rearrange entries on the classpath, select a desired entry and press the btn:[Move Down] or btn:[Move Up] button. Press btn:[OK].

. To edit the full path string, press the btn:[Edit Text] button. This opens the ‘Edit Classpath’ dialog box.
+
image:Scheduler Classpath 3.png[]
+
Make the desired edits and press btn:[OK]. Press btn:[OK] again to exit the ‘Schedule Classpath ‘ dialog box.

== Set Task Notifications
To configure notifications for Scheduler status, scroll down to the ‘Notification’ panel. This allows the server to send a one-time message if a Scheduled task or the Scheduler application stops abnormally. A ‘Mail Host’ and ‘From Email Address’ must be specified on the ‘Mail Configuration’ page (see xref:ConfigureServerEmail.adoc[]).

image:schedulerNotification.png[]

The following options are available:

Email Address:: A comma- or semicolon-separated list of email addresses to which Scheduler notifications should be sent.
Notify on Task Failure:: Send a notification if a scheduled task could not be completed.
Notify on Scheduler Down:: Send a notification if the Scheduler application stops abnormally.
Subject:: Subject line of the email.
Message:: Body of the email.

== Define Time Ranges

include::ROOT:partial$siteAdminOnly.adoc[]

When you create a scheduled task (as an administrator or user), you can select a “time range” for the task rather specifying a fixed time. This allows scheduled tasks to be automatically distributed in time for optimal performance.

To create a new time range, follow the steps below:

. Press the btn:[Add] button in the ‘Time Ranges’ panel.
+
image:schedulerTimeRangeDef.png[]

. In the ‘Time Range’ dialog box, enter a name for the time range, and specify the start and end times.
+
image:schedulerTimeRangeDef2.png[]

. *_Optional:_* Select ‘Default’ to make this the default time range.
. *_Optional:_* Select the *Security* tab in the dialog box, and assign permissions for this particular time range to different users, groups, or roles.
+
TIP: To specify in general which users, groups, and roles have access to the time range feature for scheduling, use the  ‘Time Range’ option on the *Actions* tab of the *Security* page. See xref:SetSecurityActions.adoc[] for instruction on how to assign action permissions.

. Press btn:[OK].

To edit a time range, click on the range’s name in the list.

== Restrict Server Save Paths
To restrict the server paths on which a scheduled task can save files, follow the steps below:

. Press the btn:[Add] button in the ‘Server Save Paths’ panel.
+
image:serverSavePaths.png[]

. In the ‘Server Save Path’ dialog box, enter a label for the path, and specify the corresponding server path.
+
image:serverSavePaths2.png[]
+
To save to an FTP server, check  the '`FTP/SFTP`' box and enter a valid '`Path`', '`Username`' and '`Password`'.
+
IMPORTANT: For SFTP connections, the known hosts file, _.ssh/known_hosts_, is automatically read from the user’s home directory. Before running the scheduled task, an administrator should populate the _known_hosts_ file by first connecting (SSH) to the target server from each InetSoft server node.

. Press btn:[OK].

. Repeat the above steps to add additional server paths.

. Press btn:[Apply].

To edit a server path, click on the path label in the list. Scheduled save actions defined in Enterprise Manager (see xref:SetSecurityActions.adoc[]) and the User Portal  (see xref:user:ScheduleDashboard.adoc[]) will be able to access only the server paths that you specify here. If you specify no server paths, there will be no restrictions on the save location.




== Execute Custom Scheduler Code
To execute custom code before or after a scheduled task executes, implement the https://www.inetsoft.com/docs/stylebi/apidoc/index.html?inetsoft/sree/schedule/TaskListener.html[inetsoft.sree.schedule.TaskListener] interface. There are two methods in the interface.

taskStarted:: Invoked when the task begins
taskCompleted:: Invoked when the task ends

To attach a listener to a scheduled task, add property `schedule.task.listener`. The property should specify the fully qualified name of the listener class. {EMPropertyConfig}


.Example: Task Listener
[source,java]
----
import inetsoft.sree.schedule.*;
import java.util.*;
import java.security.*;

public class DefaultTaskListener implements TaskListener {
   public void taskStarted(ScheduleTask task, Principal user) {
      // Code to invoke when task starts
   }

   public void taskCompleted(ScheduleTask task, Principal user, List<Throwable> errors) {
      // Code to invoke when task completes
   }
}
----
